# La línea 'version' se ha eliminado por ser obsoleta (era solo un warning)

services:
  mongodb:
    image: mongo:latest
    container_name: eventos_mongodb
    ports:
      - "27017:27017"
    volumes:
      - mongodb_data:/data/db
    environment:
      - MONGO_INITDB_DATABASE=eventos_db
    networks:
      - eventos_network

  backend:
    build: ./backend  # <-- CORREGIDO: Apunta a la carpeta que contiene el Dockerfile del backend
    container_name: eventos_backend
    ports:
      - "5500:5500"
    depends_on:
      - mongodb
    environment:
      - MONGODB_URI=mongodb://mongodb:27017/eventos_db
      - PORT=5500
    volumes:
      - ./backend:/app  # <-- CORREGIDO: Mapea solo el código del backend para el hot-reload
      - /app/node_modules
    networks:
      - eventos_network
    command: npm run dev
  frontend:
    build: ./frontend
    container_name: eventos_frontend
    ports:
      # Puerto para Create React App
      - "3000:3000"
    volumes:
      - ./frontend:/app # Mapea tu código de frontend para hot-reload
      - /app/node_modules
    networks:
      - eventos_network
    depends_on:
      - backend # Se asegura de iniciar después del backend
    environment:
      # Variable de entorno para Create React App
      - REACT_APP_API_URL=http://localhost:5500/api

volumes:
  mongodb_data:

networks:
  eventos_network:
    driver: bridge